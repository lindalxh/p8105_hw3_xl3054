p8105_hw3_xl3054
================
Xinhui Lin (xl3054)
2025-10-13

# Problem 1

``` r
library(tidyverse)
```

    ## ── Attaching core tidyverse packages ──────────────────────── tidyverse 2.0.0 ──
    ## ✔ dplyr     1.1.4     ✔ readr     2.1.5
    ## ✔ forcats   1.0.0     ✔ stringr   1.5.1
    ## ✔ ggplot2   3.5.2     ✔ tibble    3.3.0
    ## ✔ lubridate 1.9.4     ✔ tidyr     1.3.1
    ## ✔ purrr     1.1.0     
    ## ── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──
    ## ✖ dplyr::filter() masks stats::filter()
    ## ✖ dplyr::lag()    masks stats::lag()
    ## ℹ Use the conflicted package (<http://conflicted.r-lib.org/>) to force all conflicts to become errors

``` r
library(p8105.datasets)
data("instacart")
```

The `instacart` dataset has 1384617 rows and 15 columns in total. The
columns include variables identifying the order, product, customer,
aisle, department, time of order, and indicating whether the product was
reordered. Within the 1384617 observations, there are 131209 unique
users.

``` r
aisle_uniq = instacart %>% count(aisle, sort = TRUE)
```

There are 134 aisles. The aisle of fresh vegetables has the most items
ordered from.

``` r
instacart %>% count(aisle, name = "items_ordered") %>% 
  filter(items_ordered > 10000) %>% 
  mutate(aisle = fct_reorder(aisle, items_ordered)) %>% 
  ggplot(aes(x = aisle, y = items_ordered)) + 
  geom_col() + 
  coord_flip() +
  labs(title = "Number of Items Ordered by Aisle (>10000)",
       x = "Aisle",
       y = "Items ordered") +
  theme_minimal()
```

![](p8105_hw3_xl3054_files/figure-gfm/unnamed-chunk-3-1.png)<!-- -->

``` r
instacart %>% filter(aisle %in% 
                       c("baking ingredients", "dog food care", "packaged vegetables fruits")) %>% 
  count(aisle, product_name, sort = TRUE) %>% 
  group_by(aisle) %>% 
  slice_max(n, n = 3) %>% 
  arrange(aisle, desc(n))      
```

    ## # A tibble: 9 × 3
    ## # Groups:   aisle [3]
    ##   aisle                      product_name                                      n
    ##   <chr>                      <chr>                                         <int>
    ## 1 baking ingredients         Light Brown Sugar                               499
    ## 2 baking ingredients         Pure Baking Soda                                387
    ## 3 baking ingredients         Cane Sugar                                      336
    ## 4 dog food care              Snack Sticks Chicken & Rice Recipe Dog Treats    30
    ## 5 dog food care              Organix Chicken & Brown Rice Recipe              28
    ## 6 dog food care              Small Dog Biscuits                               26
    ## 7 packaged vegetables fruits Organic Baby Spinach                           9784
    ## 8 packaged vegetables fruits Organic Raspberries                            5546
    ## 9 packaged vegetables fruits Organic Blueberries                            4966

``` r
instacart %>% filter(product_name %in% c("Pink Lady Apples", "Coffee Ice Cream")) %>% 
  group_by(product_name, order_dow) %>% 
  summarise(mean_hour = mean(order_hour_of_day), .groups = "drop") %>% 
  mutate(order_dow = recode(order_dow,
                            `0` = "Sunday",
                            `1` = "Monday",
                            `2` = "Tuesday",
                            `3` = "Wednesday",
                            `4` = "Thursday",
                            `5` = "Friday",
                            `6` = "Saturday")) %>%
  pivot_wider(names_from = order_dow,
              values_from = mean_hour)
```

    ## # A tibble: 2 × 8
    ##   product_name     Sunday Monday Tuesday Wednesday Thursday Friday Saturday
    ##   <chr>             <dbl>  <dbl>   <dbl>     <dbl>    <dbl>  <dbl>    <dbl>
    ## 1 Coffee Ice Cream   13.8   14.3    15.4      15.3     15.2   12.3     13.8
    ## 2 Pink Lady Apples   13.4   11.4    11.7      14.2     11.6   12.8     11.9

# Problem 2

``` r
zip_codes = read_csv(file = "./Data/Zip Codes.csv") %>%  ## load data
  janitor::clean_names() %>%  ## clean data
  select(zip_code, county, neighborhood, county_fips) %>%  ## select related columns
  slice(-c(226, 227)) ## remove repeated zipcodes
```

    ## Rows: 322 Columns: 7
    ## ── Column specification ────────────────────────────────────────────────────────
    ## Delimiter: ","
    ## chr (4): County, County Code, File Date, Neighborhood
    ## dbl (3): State FIPS, County FIPS, ZipCode
    ## 
    ## ℹ Use `spec()` to retrieve the full column specification for this data.
    ## ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.

``` r
## zori
zori = read_csv(file = "./Data/Zip_zori_uc_sfrcondomfr_sm_month_NYC.csv") %>%  ## load data
  janitor::clean_names() %>%  ## clean data
  pivot_longer(cols = starts_with("x"), 
    names_to = "date",
    values_to = "zori") %>%  ## pivot longer by dats
  mutate(date = str_remove(date, "^x")) %>%  ## clean date format
  separate(date, into = c("year", "month", "day"), sep = "_") %>%  ## separate into year, month, day
  mutate(year = as.integer(year), 
    month = month.name[as.integer(month)]) %>%
  select(-c(state))  ## make year into integer, month as full name, remove state (repeated)
```

    ## Rows: 149 Columns: 125
    ## ── Column specification ────────────────────────────────────────────────────────
    ## Delimiter: ","
    ## chr   (6): RegionType, StateName, State, City, Metro, CountyName
    ## dbl (119): RegionID, SizeRank, RegionName, 2015-01-31, 2015-02-28, 2015-03-3...
    ## 
    ## ℹ Use `spec()` to retrieve the full column specification for this data.
    ## ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.

``` r
## merging
combined = right_join(zip_codes, zori, by = c("zip_code" = "region_name")) %>%
  select(year, month, ## time
         zip_code, county_fips, region_id,  ## ids
         state_name, city, county_name, region_type, neighborhood, metro, size_rank,  ## geographic
         zori) ## metric
```

``` r
obs_116 = combined %>% filter(!is.na(zori)) %>% 
  count(zip_code, sort = TRUE) %>% filter(n==116)
```

48 ZIP codes are observed 116 times.

``` r
obs_10 = combined %>% filter(!is.na(zori)) %>% 
  count(zip_code, sort = TRUE) %>% filter(n<10)
```

48 ZIP codes are observed fewer than 10 times.

################ xxxxxxxxxxWhy are some ZIP codes are observed rarely and others observed in each month?

``` r
combined %>%
  group_by(county_name, year) %>%
  summarize(mean_zori = mean(zori, na.rm = TRUE), .groups = "drop") %>%
  arrange(county_name, year) %>% 
  mutate(mean_zori = round(mean_zori, 2)) %>%
  pivot_wider(names_from = year, values_from = mean_zori)
```

    ## # A tibble: 5 × 11
    ##   county_name     `2015` `2016` `2017` `2018` `2019` `2020` `2021` `2022` `2023`
    ##   <chr>            <dbl>  <dbl>  <dbl>  <dbl>  <dbl>  <dbl>  <dbl>  <dbl>  <dbl>
    ## 1 Bronx County     1760.  1520.  1544.  1639.  1706.  1811.  1858.  2054.  2285.
    ## 2 Kings County     2493.  2520.  2546.  2547.  2630.  2555.  2550.  2868.  3015.
    ## 3 New York County  3022.  3039.  3134.  3184.  3310.  3107.  3137.  3778.  3933.
    ## 4 Queens County    2215.  2272.  2263.  2292.  2388.  2316.  2211.  2406.  2562.
    ## 5 Richmond County   NaN    NaN    NaN    NaN    NaN   1978.  2045.  2147.  2333.
    ## # ℹ 1 more variable: `2024` <dbl>

############### Comment on trends in this table.

``` r
zori_all = combined %>%
  filter(!is.na(county_name), !is.na(year), !is.na(zori)) %>%
  group_by(county_name, year, zip_code) %>%
  summarize(mean_zori = mean(zori, na.rm = TRUE), .groups = "drop") %>% 
  ggplot(aes(x = year, y = mean_zori, group = zip_code, color = county_name)) + 
  geom_line(alpha = 0.5) +
  theme_minimal() + 
  scale_x_continuous(breaks = seq(from = min(pull(combined, year), na.rm = TRUE),
                                  to = max(pull(combined, year), na.rm = TRUE),
                                  by = 1)) +
  labs(title = "NYC Rental Prices by ZIP Code and Borough",
       x = "Year",
       y = "Average Rental Price (ZORI)",
       color = "Borough")
```

########## xxxxxxxxxxxx comment on any significant elements of this plot.

``` r
zori_2023 = combined %>%
  filter(year == 2023, !is.na(county_name), !is.na(month), !is.na(zori)) %>%
  group_by(county_name, zip_code, month) %>%
  summarize(mean_zori = mean(zori, na.rm = TRUE), .groups = "drop") %>% 
  ggplot(aes(x = county_name, y = mean_zori, fill = county_name)) +
  geom_violin(trim = TRUE, alpha = 0.6) +
  geom_boxplot(width = 0.15, outlier.shape = NA, alpha = 0.8, color = "black") +
  theme_minimal() +
  labs(title = "Distribution of 2023 ZIP-Level Rental Prices (ZORI) Across NYC Boroughs",
       x = "Borough",
       y = "Average Monthly Rental Price (ZORI)",
       fill = "Borough")
#  theme(
#    legend.position = "none",
#    plot.title = element_text(face = "bold", size = 14),
#    axis.text.x = element_text(angle = 25, hjust = 1)
#  )
```

################ Comment on this plot

``` r
## combine two plots and export
```

# Problem 3

``` r
library(httr)
demographic = read_csv("https://p8105.com/data/nhanes_covar.csv", skip = 4)
```

    ## Rows: 250 Columns: 5
    ## ── Column specification ────────────────────────────────────────────────────────
    ## Delimiter: ","
    ## dbl (5): SEQN, sex, age, BMI, education
    ## 
    ## ℹ Use `spec()` to retrieve the full column specification for this data.
    ## ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.

``` r
accelerometer = read_csv("https://p8105.com/data/nhanes_accel.csv")
```

    ## Rows: 250 Columns: 1441
    ## ── Column specification ────────────────────────────────────────────────────────
    ## Delimiter: ","
    ## dbl (1441): SEQN, min1, min2, min3, min4, min5, min6, min7, min8, min9, min1...
    ## 
    ## ℹ Use `spec()` to retrieve the full column specification for this data.
    ## ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.

``` r
acc_merged = left_join(demographic, accelerometer, by = "SEQN")

acc_merged = acc_merged %>%
  janitor::clean_names() %>% 
  filter(age>=21) %>% 
  drop_na(sex, age, bmi, education) %>% 
  mutate(sex = case_when(
      sex == "1" ~ "Male",
      sex == "2" ~ "Female"),
    sex = factor(sex, levels = c("Male", "Female")),
    education = case_when(
      education == "1" ~ "Less than high school",
      education == "2" ~ "High school equivalent", 
      education == "3" ~ "More than high school"), 
    education = factor(education, levels = c("Less than high school", 
                                             "High school equivalent", 
                                             "More than high school")))
```

table

``` r
acc_merged  %>% 
  count(education, sex, name = "n") %>% 
  pivot_wider(names_from = sex, values_from = n)
```

    ## # A tibble: 3 × 3
    ##   education               Male Female
    ##   <fct>                  <int>  <int>
    ## 1 Less than high school     27     28
    ## 2 High school equivalent    35     23
    ## 3 More than high school     56     59

################ xxxxxxcomment

plot

``` r
acc_merged %>% ggplot(aes(x = age, fill = sex)) + 
  geom_density(alpha = 0.3) + 
  facet_wrap(~ education, nrow = 1) +
  theme_minimal() + 
  labs(
    title = "Age distributions by sex and education", 
    x = "Age (years)", 
    y = "Density", 
    fill = "Sex"
  )
```

![](p8105_hw3_xl3054_files/figure-gfm/unnamed-chunk-15-1.png)<!-- -->
\################ xxxxxxcomment

total activity

``` r
acc_merged %>% 
  pivot_longer(
    cols = matches("^min", ignore.case = TRUE),
    names_to = "minute_var",
    values_to = "mims") %>% 
  group_by(seqn) %>% 
  summarise(total_mims = sum(mims),
            .groups = "drop") %>% 
  left_join(acc_merged[,1:5], by = "seqn") %>% 
  ggplot(aes(x = age, y = total_mims, color = sex)) + 
  geom_point(alpha = 0.5) + 
  geom_smooth(se = FALSE) + 
  facet_wrap(~ education) +
  theme_minimal() +
  labs(title = "Total daily activity (MIMS) vs Age",
       x = "Age (years)",
       y = "Total MIMS (per day)",
       color = "Sex")
```

    ## `geom_smooth()` using method = 'loess' and formula = 'y ~ x'

![](p8105_hw3_xl3054_files/figure-gfm/unnamed-chunk-16-1.png)<!-- -->
\################ xxxxxxcomment

``` r
acc_merged %>% 
  pivot_longer(
    cols = matches("^min", ignore.case = TRUE),
    names_to = "minute_var",
    values_to = "mims") %>% 
  mutate(minute = as.integer(str_remove(minute_var, "^min")),
         hour = minute / 60) %>% 
  ggplot(aes(x = hour, y = mims, color = sex)) +
  geom_smooth() +
  facet_wrap(~ education, ncol = 1) + 
  labs(x = "Hour of Day",
       y = "Activity (MIMS units)",
       title = "24-hour Accelerometer Activity by Education Level and Sex",
       color = "Sex") +
  theme_minimal()
```

    ## `geom_smooth()` using method = 'gam' and formula = 'y ~ s(x, bs = "cs")'

![](p8105_hw3_xl3054_files/figure-gfm/unnamed-chunk-17-1.png)<!-- -->
